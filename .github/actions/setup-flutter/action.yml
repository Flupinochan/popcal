name: 'Setup Flutter Environment'
description: 'Flutter setup with FVM support and fallback'

inputs:
  flutter-version:
    description: 'Fallback Flutter version'
    required: false
    default: '3.32.8'
  cache:
    description: 'Enable caching for Flutter SDK and pub dependencies'
    required: false
    default: 'true'

runs:
  using: 'composite'

  steps:
    # runs-on: windows-latest環境ではJava7であり古いため
    - name: Set up Java
      uses: actions/setup-java@v4
      java-version: '17'
      distribution: 'temurin'

    # .fvmrcのバージョンを参照
    - name: Set up Flutter
      id: fvm-setup
      uses: kuhnroyal/flutter-fvm-config-action/setup@v3
      with:
        cache: ${{ inputs.cache }}
      continue-on-error: true

    - name: Set up Flutter (fallback)
      if: steps.fvm-setup.outcome == 'failure'
      uses: subosito/flutter-action@v2
      with:
        cache: ${{ inputs.cache }}
        channel: 'stable'
        flutter-version: ${{ inputs.flutter-version }}

    - name: Install dependencies (Windows)
      if: runner.os == 'Windows'
      run: flutter pub get
      shell: pwsh

    - name: Install dependencies (Linux/macOS)
      if: runner.os != 'Windows'
      run: flutter pub get
      shell: bash
